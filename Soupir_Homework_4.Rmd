---
title: "Homework 4"
author: "Alex Soupir"
date: "September 20, 2019"
output:
  pdf_document:
    keep_md: true
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=F,warning=F,echo=F,fig_height=10,fig_width=7,cache = F)
```

*Packages*: MASS, GGPlot, Mclust, HSAUR3

*Collaborators*:



<!--
Very easy to let the data lie to you

-->

<!--
Discussion questions:
Lisst any assumptions you made that weren’t explicitly given in the problem.  
Did you get the results you expected? 
Did you run into any complications?  
Did you agree with your collaborators about the results?
Tell me anything you think is important here.
-->

Please do the following problems from the text book R Handbook and stated.

1. The \textbf{galaxies} data from \textbf{MASS} contains the velocities of 82 galaxies from six well-separated conic sections of space (Postman et al., 1986, Roeder, 1990). The data are intended to shed light on whether or not the observable universe contains superclusters of galaxies surrounded by large voids. The evidence for the existence of superclusters would be the multimodality of the distribution of velocities.(8.1 Handbook)

    a.) Construct histograms using the following functions: 
    
        -hist() and ggplot()+geom_histogram()
        
    ```{r, echo=FALSE}
    library(MASS)
    gdf = as.data.frame(galaxies)
    colnames(gdf)[1] = "Velocity"
    
    hist(gdf$Velocity, main="Galaxy Velocities Histogram", xlab="Velocity", ylab="Count")
    
    library(ggplot2)
    ggplot(gdf, aes(x=Velocity))+geom_histogram(binwidth=5000, origin=5000)+
      labs(x = "Velocity", y="Count", title="Galaxy Velocities Histogram")
    ```
      
        -truehist() and ggplot+geom_histogram() (pay attention to the y-axis!)
        
    ```{r, echo=FALSE}
    truehist(gdf$Velocity, main="Galaxy Velocities Histogram", xlab="Velocity", ylab="Frequency")
    
    ggplot(gdf, aes(x=Velocity, y=..density..))+geom_histogram(binwidth=5000, origin=5000)+
      labs(x = "Velocity", y="Frequency", title="Galaxy Velocities Histogram")
    ```
      
        -qplot()
        
    ```{r, echo=FALSE}
    qplot(gdf$Velocity) + labs(x="Velocity",y="Frequency",title="Galaxy Velocities Histogram")
    ```
        
    Comment on the shape and distribution of the variable based on the three plots. (Hint: Also play around with binning)
    
    **The shape of both the regular histogram and the *truehist()* is the same, but the y-axis of *truehist()* is the frequency, with the total area being 1 while *hist()* provides the number of galaxies in each bin. The *qplot()* function also provides the counts for the number of galaxies in each provided bin. The number of bins (and bin width) for *hist()* and *truehist()* is the same by default while *qplot()* chooses a much smaller bin width which tells a much different story.**
    
    **GGPlot picks a different way to plot its histogram, picking different starting bin locations. This caused some difficulties since they weren't looking the same as the default outputs for the other first functions. The origin for ggplot had to be set at 5000 in order to make the plots look similar.**
    
    b.) Create a new variable \textit{loggalaxies} = $\log$(galaxies). Construct histograms using the functions in part a.) and comment on the shape and differences.
    
    ```{r, echo=FALSE}
    gdf$loggalaxies = log(gdf$Velocity)
    
    hist(gdf$loggalaxies, main="Galaxy Velocities Histogram", xlab="log(Velocity)", ylab="Count")
    truehist(gdf$loggalaxies, main="Galaxy Velocities Histogram", xlab="log(Velocity)", ylab="Frequency")
    qplot(gdf$loggalaxies) + labs(x="log(Velocity)",y="Frequency",title="Galaxy Velocities Histogram")
    ```
    
    **The *hist()* and *truehist()* look similar when plotting the log of velocity as to when plotting the velocity. However, the *truehist()* plot y-axis now shows a value that doesn't have a total area equal to 1. The bin size of *qplot()* is also different than the other 2 methods. **
    
    c.) Construct kernel density estimates using two different choices of kernel functions and three choices of bandwidth (one that is too large and “oversmooths,” one that is too small and “undersmooths,” and one that appears appropriate.) Therefore you should have six different kernel density estimates plots. Discuss your results. You can use the log scale or original scale for the variable.
    
    ```{r, echo=FALSE}
    par(mfrow=c(2,3))
    x=gdf$Velocity
    bwd = 2000
    hist(x, ylim=c(0, 1.4e-04), xlab="Velocity", ylab="Frequency", probability=TRUE, main=paste("Gaussian Kernal, bw=", bwd, sep=""))
    lines(density(x, width=bwd), lwd=2)
    
    bwd = 5000
    hist(x, ylim=c(0, 1.4e-04), xlab="Velocity", ylab="Frequency", probability=TRUE, main=paste("Gaussian Kernal, bw=",bwd, sep=""))
    lines(density(x, width=5000), lwd=2)
    
    bwd = 20000
    hist(x, ylim=c(0, 1.4e-04), xlab="Velocity", ylab="Frequency", probability=TRUE, main=paste("Gaussian Kernal, bw=",bwd, sep=""))
    lines(density(x, width=20000), lwd=2)
    
    bwd = 2000
    hist(x, ylim=c(0, 1.4e-04), xlab="Velocity", ylab="Frequency", probability=TRUE, main=paste("Triangular Kernal, bw=",bwd, sep=""))
    lines(density(x, width=2000, window = "triangular"), lwd=2)
    
    bwd = 5000
    hist(x, ylim=c(0, 1.4e-04), xlab="Velocity", ylab="Frequency", probability=TRUE, main=paste("Triangular Kernal, bw=",bwd, sep=""))
    lines(density(x, width=5000, window = "triangular"), lwd=2)
    
    bwd = 20000
    hist(x, ylim=c(0, 1.4e-04), xlab="Velocity", ylab="Frequency", probability=TRUE, main=paste("Triangular Kernal, bw=",bwd, sep=""))
    lines(density(x, width=20000, window = "triangular"), lwd=2)
    
    par(mfrow=c(1,1))
    ```
    
    **The different bin widths changed the appearence of the line a great deal. With a bin width too low, the line is very sporadic and the bin width being too large causes over-smoothing. Between the gaussian kernal and triangular kernal, there doesn't seem to be much difference besides in the bin width of 2000 where triangular is slightly more jagged.**
    
    d.) What is your conclusion about the possible existence of superclusterd of galaxies? How many superclusters (1,2, 3, ... )?
    
    **From the first set of histograms, the *qplot()* shows that there may be <u>3</u> different superclusters. This is further supprted by the bin width of 5000 gaussian and triangular curves. The kernals with low bin widths show that there may be <u>2</u> superclusters located in the center of the velocities for a total of <u>4</u>, but this may be from just the bin widths now showing appropriate information.**
    
    e.) How many clusters did it find? Did it match with your answer from (d) above? Report parameter estimates and BIC of the best model.
    
    ```{r, echo=FALSE}
    library(mclust)
    clusters = Mclust(gdf$Velocity)
    summary(clusters, parameters=TRUE)
    
    ```
    
    ```{r, echo=FALSE}
    mclustBIC(gdf$Velocity)
    
    ```
    
    **Lecture mentiones that *Mclust()* uses the EM algorithm to find the optimal number of clusters. The number of clusters that were found was 4. This doesn't match up with the initial estimate of there being <u>3</u> clusters. It does match the number of clusters estimated after thinking that there may be 2 clusters hidden within the middle peak. The cluster means are <u>9707.5, 19804.3, 22879.5, and 24459.5</u>.**
    
    **Looking at the best models using the BIC criterion, 4 superclusters produced the best model with the next best model being 3 superclusters. This agrees with the previous statement.**
    
2. The \textbf{birthdeathrates} data from \textbf{HSAUR3} gives the birth and death rates for 69 countries (from Hartigan, 1975). (8.2 Handbook)

    a.) Produce a scatterplot of the data and overlay a contour plot of the estimated bivariate density.
    
    ```{r, echo=FALSE}
    library(HSAUR3)
    library(KernSmooth)
    bdf = birthdeathrates
    bdf2 = bkde2D(bdf, bandwidth = sapply(bdf, dpik))
    
    contour(x=bdf2$x1, y=bdf2$x2, z=bdf2$fhat,
            xlab="Birth Rate",
            ylab="Death Rate",
            main="Scatterplot of Birth and Death Rate for 69 Countries with a Contour Plot")
    points(bdf, pch=16, col='red')
    
    ggplot(data=bdf, aes(birth, death))+ geom_density2d()+ geom_point()+ xlim(5, 60)+ ylim(0, 35)+ labs(title="Scatterplot of Birth and Death Rate for 69 Countries with a Contour Plot")
    ```
    
    b.) Does the plot give you any interesting insights into the possible structure of the data?
    
    **The contour plot does provide someinteresting insight into the data, mainly there being a large cluster around 20 birth - 10 deaths. It shows that there are a few countries that tend to have much greater ratios between birth and death rates, some close to 50 births - 10 deaths. There are some points that are outside the contour plot which may be outliers in the data, but without further emperical tests is hard to say whether or not they actually are outliers. The base R plot and the ggplot show differing bounds of the contour plot, as well. I'm thinking this is probably due to the function used to calculate the contours which is defined as *dpik* for the base R plot, but not defined for the ggplot so it is using some internal calculation.**
    
    c.) Construct the perspective plot (persp() in R, GGplot is not required for this question).
    
    ```{r, echo=FALSE}
    persp(x=bdf2$x1, y=bdf2$x2, z=bdf2$fhat,
          xlab="Birth Rate",
          ylab="Death Rate",
          zlab="Estimated Density",
          main="Perspective Plot of Birth and Death Rate for 69 Countries",
          theta=45,axis=TRUE,box=TRUE)
    ```
    
    d.) Model-based clustering (Mclust). Provide plot of the summary of your fit (BIC, classification, uncertainty, and density).
    
    ```{r, echo=FALSE}
    bdr = Mclust(bdf)
    summary(bdr, parameters=TRUE)
    ```
    
    ```{r, echo=FALSE}
    mclustBIC(bdf)
    
    ```
    
    ```{r, echo=FALSE}
    plot(bdr, what='BIC')
    plot(bdr, what='classification')
    plot(bdr, what='uncertainty')
    plot(bdr, what='density')
    
    ```
    
    e.) Discuss the results (structure of data, outliers, etc.). Write a discussion in the context of the problem.
    
    **The *Mclust* results show that there are 4 clusters located within the data around birth:death means of [55.9:29.3, 43.8:12.1, 19.9:9.1, and 33.7:8.5]. This is confirmed with *mclustBIC* which shows that the top 2 models have 4 unique clusters, while the 3rd best has 3 unique clusters. Observing the density plot we see that a great deal of the data points fall in that 20 births to 10 deaths location, as previously mentioned. This density plot, however, does not show a 4th cluster that the classification plot shows up in the far corner, the high number of births and deaths. There is a country at about 15 births and 20 deaths, which indicates that its population is most likely decreasing, barring emmigration.**

3. A sex difference in the age of onset of schizophrenia was noted by Kraepelin (1919). Subsequent epidemiological studies of the disorder have consistently shown an earlier onset in men than in women. One model that has been suggested to explain this observed difference is known as the subtype model which postulates two types of schizophrenia, one characterized by early onset, typical symptoms and poor premorbid competence; and the other by late onset, atypical symptoms and good premorbid competence. The early onset type is assumed to be largely a disorder of men and the late onset largely a disorder of women. Fit finite mixutres of normal densities separately to the onset data for men and women given in the \textbf{schizophrenia} data from \textbf{HSAUR3}. See if you can produce some evidence for or against the subtype model. (8.3 Handbook)

```{r, echo=FALSE}
sdf = schizophrenia

sdf.m = subset(sdf, gender == "male")
sdf.f = subset(sdf, gender == "female")

par(mfrow=c(2,1))
hist(sdf.m$age, main="Histogram of Male Patient Ages")
hist(sdf.f$age, main="Histogram of Female Patient Ages")

```

**The histograms broke up by the gender of the patients shows that there may be a difference in the ages with males peaking between 15-25 with cases and females peaking between 25-30. There is also a difference in the number of samples per gender (males has 152 observations and females have 99 observations) that could make it difficult to determine whether the difference seen here is due to not having enough samples or true differences.**

```{r, echo=FALSE}
schiz = Mclust(sdf$age)
summary(schiz, parameters=TRUE)

mclustBIC(sdf$age)
```

**With the pooled data, there appears to be 2 clusters located around 22.9 and 45.3 age. This doesn't match up with the the histograms though because one of the clusters is on the tails of *BOTH* of the plots. Next, I'll try *Mclust()* on the subset data to see if the means for male and female differ when separated.**

```{r, echo=FALSE}
male.cl = Mclust(sdf.m$age)
summary(male.cl, parameters=TRUE)

```

```{r, echo=FALSE}
female.cl = Mclust(sdf.f$age)
summary(female.cl, parameters=TRUE)

```

**With the subset data by gender, we now start to see differences in the means of the formed clusters. Both of the male clusters are below the age of 30 (20.3 and 27.7) while the females have clusters almost twice their ages (24.9 and 46.9).**

```{r, echo=FALSE}
print("Male Density")
plot(male.cl, what='density', main="Male Density")
print("Female Density")
plot(female.cl, what='density', main="Female Density")

```

**The density plots of the *Mclust()* model start to tell more of the story in differences between the genders' ages. The male plot has a strong peak around the age of 20. The female plot also has a peak around 25 or so but its more broad, and then there is another peak around 45-50 that is smaller but definitive.**

**From all of the above, it is fairly evident that both males and females have an optimal cluster number of 2. These cluster are extremely different in the distances from each other within males and females, which relates to there being differences in ages between the genders. Males have 2 clusters between 20 and 30 while females have clusters at 25 and 47. The clusters within the male overvations are more difficult to tell the difference between the 2 as shown in the male density plot (there is a minor bump around 30 that makes the plot appear unnatural {difficult to describe}) while the female plot shows 2 different peaks. Because of these results, I would say that there is evidence that there are potentially different types of schizophrenia that each gender is more prone too, but not found only in an individual gender.**

Resources:

+ StackExchange
+ ggplot2.tidyverse.org (contour plot)



























































